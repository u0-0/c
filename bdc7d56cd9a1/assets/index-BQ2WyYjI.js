var ut=Object.defineProperty;var dt=(e,t,r)=>t in e?ut(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var L=(e,t,r)=>dt(e,typeof t!="symbol"?t+"":t,r);import{s as A,j as i,S as y,B as v,r as g,C as te,a as ft,A as Ve,I as T,b as m,M as ht,c as gt,d as Me,o as mt,e as G,f as Ge,u as Je,g as Ke,p as pt,F as w,T as xt,h as ve,R as vt,i as yt,k as jt,l as bt,m as wt,n as ue,q as St,t as Le,v as Ct,w as ye,Q as Et,x as Tt,y as _t,P as We,z,D as Rt,E as Ot,G as kt,H as It}from"./vendor-CYIT8ra7.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=r(o);fetch(o.href,s)}})();let Lt=36e5;setTimeout(()=>{const e=document.scrollingElement.dataset.building_date_time,t="new-version-tip";async function r(){(await(await fetch("/")).text()).match(/data-building_date_time="([^"]+)"/)[1]!==e&&(clearInterval(n),A.info({key:t,message:"有新版本可用",duration:-1,closable:!1,btn:i.jsxs(y,{children:[i.jsx(v,{color:"primary",variant:"filled",onClick:()=>{location.reload()},children:"刷新页面体验"}),i.jsx(v,{color:"default",variant:"filled",onClick:()=>{A.destroy(t),o()},children:"1 小时后提醒"})]})}))}let n=-1;function o(){clearInterval(n),n=setInterval(r,Lt)}o()});async function Dt(e,t="image/png"){const{canvas:r}=await Nt(e);return new Promise((n,o)=>{r.toBlob(function(s){s?n(s):o("无法转换为 blob, canvas BlobCallback result === null.")},t,1)})}async function Nt(e){if(!e)throw new Error("src 不能为空。");return new Promise((t,r)=>{const n=document.createElement("canvas"),o=n.getContext("2d");if(!o)throw new Error("canvas.getContext returns"+o);const s=new Image;s.onload=function(){let{width:a,height:u}=s;n.width=a,n.height=u,o.fillStyle="#fff",o.fillRect(0,0,a,u),o.drawImage(s,0,0),t({context2d:o,width:a,height:u,canvas:n})},s.onerror=function(a,u,l,c,d){r("img.onerror! src ="+e)},s.src=e})}function Pt(e,t="image/png"){const r=typeof e=="string"?e:new XMLSerializer().serializeToString(e);return"data:image/svg+xml;base64,"+window.btoa(window.unescape(encodeURIComponent(r)))}function Ut(e,t){const r=t==null?void 0:t.width,n=t==null?void 0:t.height;let o=(t==null?void 0:t.scale)||1;const s=new XMLSerializer().serializeToString(e),a=document.createElement("canvas"),u=a.getContext("2d"),l=new Image,c=new Blob([s],{type:"image/svg+xml;charset=utf-8"}),d=URL.createObjectURL(c);l.onload=function(){r&&!n?o*=r/l.width:n&&!r&&(o*=n/l.height),a.width=l.width*o,a.height=l.height*o,u.drawImage(l,0,0,a.width,a.height),URL.revokeObjectURL(d);var f=a.toDataURL("image/png"),h=document.createElement("a");h.href=f,h.download="图片.png",document.body.appendChild(h),h.click(),document.body.removeChild(h)},l.src=d}function At(e){const t=new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-");return t.slice(0,10)+" "+t.slice(10)}function Bt(e,t=1e3,r){let n=0;return function(){let o=Date.now();o-n<t||(n=o,e.apply(this,arguments))}}function De(e,t){const r=document.createElement("a");r.href=URL.createObjectURL(e),r.download=t,document.body.appendChild(r),r.click(),setTimeout(()=>{URL.revokeObjectURL(r.href),r.remove()},6e4)}const Ne=Bt(function(t){const r=[...(t==null?void 0:t.querySelectorAll("svg"))??[]];if(r.length>0){const n=r[0];n.setAttribute("viewBox",`0,0,${n.getBBox().width+20},${n.getBBox().height+20}`),n.style.width="100%",n.style.height="auto",r.splice(0,1)}r.map(n=>n.remove())},10),Pe="sequence-diagram::sequenceDiagramInput-v20230415",Te=()=>{var l,c;const[e,t]=g.useState(""),[r,n]=g.useState(localStorage[Pe]||"");g.useEffect(()=>{t("");try{localStorage[Pe]=r}catch(d){console.error(d),localStorage.clear()}},[r]);const o=g.useRef(null);g.useLayoutEffect(()=>{var f;const d=(f=o.current)==null?void 0:f.div;d&&Ne(d)},[(l=o.current)==null?void 0:l.div]),g.useLayoutEffect(()=>{var h;const d=(h=o.current)==null?void 0:h.div;if(!d)return;const f=new MutationObserver(function(x,b){Ne(d)});return f.observe(d,{subtree:!0,childList:!0,attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1}),function(){f.disconnect()}},[(c=o.current)==null?void 0:c.div]);function s(){return"时序图 "+At(Date.now())}async function a(){var f,h;const d=(h=(f=o.current)==null?void 0:f.div)==null?void 0:h.firstChild;if(!d){m.error("图标未就绪。");return}De(await Dt(Pt(d)),`${s()}.png`)}async function u(){var f,h;const d=(h=(f=o.current)==null?void 0:f.div)==null?void 0:h.firstChild;if(!d){m.error("图标未就绪。");return}De(new Blob(['<?xml version="1.0" standalone="no"?>'+new XMLSerializer().serializeToString(d)]),`${s()}.svg`)}return i.jsx("div",{children:i.jsx("div",{style:{backgroundColor:"#eee",padding:"8px 12px",width:"100%"},children:i.jsxs(y,{direction:"vertical",size:12,style:{width:"100%"},children:[i.jsx(te,{title:i.jsx(i.Fragment,{children:i.jsx(i.Fragment,{children:i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("div",{children:"时序图 SequenceDiagram"}),i.jsx("div",{style:{fontSize:"1rem",fontWeight:"normal"},children:i.jsx(i.Fragment,{children:i.jsxs(y,{children:[i.jsx("span",{children:"下载"}),i.jsx(v,{onClick:a,children:"png"}),i.jsx(v,{onClick:u,children:"svg"})]})})})]})})}),children:i.jsxs(y,{direction:"vertical",style:{width:"100%"},children:[i.jsx("div",{className:"SequenceDiagramDiv",style:{display:r.trim()?void 0:"none"},children:i.jsx(ft,{ref:o,input:r,options:{theme:"simple"},onError:d=>{t(r?JSON.stringify(d,null,2):"")}})}),e&&i.jsx(Ve,{message:e,description:null,type:"error",showIcon:!0,style:{whiteSpace:"pre-wrap"}}),i.jsx(T.TextArea,{onChange:d=>{n(d.target.value)},style:{width:"100%"},autoSize:{minRows:5},value:r})]})}),i.jsx(te,{title:"相关站点",children:["https://sequencediagram.org/","https://bramp.github.io/js-sequence-diagrams/"].map(d=>i.jsx("div",{children:i.jsx("a",{rel:"noreferrer",href:d,target:"_blank",children:d})},d))})]})})})};Te.title="时序图";Te.key="时序图";const $t="modulepreload",zt=function(e){return"https://cdn.jsdelivr.net/gh/u0-0/c@main/bdc7d56cd9a1/"+e},Ue={},B=function(t,r,n){let o=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),u=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));o=Promise.allSettled(r.map(l=>{if(l=zt(l),l in Ue)return;Ue[l]=!0;const c=l.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":$t,c||(f.as="script"),f.crossOrigin="",f.href=l,u&&f.setAttribute("nonce",u),document.head.appendChild(f),c)return new Promise((h,x)=>{f.addEventListener("load",h),f.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(a){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=a,window.dispatchEvent(u),!u.defaultPrevented)throw a}return o.then(a=>{for(const u of a||[])u.status==="rejected"&&s(u.reason);return t().catch(s)})};var Q=function(){return Q=Object.assign||function(t){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},Q.apply(this,arguments)};function F(e,t,r,n){function o(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function u(d){try{c(n.next(d))}catch(f){a(f)}}function l(d){try{c(n.throw(d))}catch(f){a(f)}}function c(d){d.done?s(d.value):o(d.value).then(u,l)}c((n=n.apply(e,t||[])).next())})}function V(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=u(0),a.throw=u(1),a.return=u(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(c){return function(d){return l([c,d])}}function l(c){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(r=0)),r;)try{if(n=1,o&&(s=c[0]&2?o.return:c[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,c[1])).done)return s;switch(o=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,o=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){r.label=c[1];break}if(c[0]===6&&r.label<s[1]){r.label=s[1],s=c;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(c);break}s[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(e,r)}catch(d){c=[6,d],o=0}finally{n=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}var de,E;(function(e){e.prod="prod",e.local="local",e.prt="prt"})(E||(E={}));function qt(e){return e===E.local||e===E.prod||e===E.prt}function Qe(e){return e===E.local?"http://127.0.0.1:22333":e===E.prt?"https://prt.memo.cool":"https://api.memo.cool"}var ae=typeof global<"u"&&!!(!((de=global==null?void 0:global.process)===null||de===void 0)&&de.version),He=!ae,_=function(){},Ae={log:{log:console.log,info:console.info,warn:console.warn,error:console.error},info:{log:_,info:console.info,warn:console.warn,error:console.error},warn:{log:_,info:_,warn:console.warn,error:console.error},error:{log:_,info:_,warn:_,error:console.error},silent:{log:_,info:_,warn:_,error:_}};function Ft(e){return Ae[e]||Ae.silent}var Vt="2025.3.7";function S(e,t){try{return e()}catch(r){t&&t(r);return}}var fe;function Mt(){var e,t;try{if(typeof((e=globalThis.crypto)===null||e===void 0?void 0:e.randomUUID)=="function")return crypto.randomUUID();if(typeof((t=globalThis.URL)===null||t===void 0?void 0:t.createObjectURL)=="function"&&globalThis.Blob){fe||(fe=new Blob);var r=URL.createObjectURL(fe),n=r.slice(-36);return URL.revokeObjectURL(r),n}}catch{}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){var s=Math.random()*16|0,a=o=="x"?s:s&3|8;return a.toString(16)})}function Gt(e){try{var t=new RegExp("(?:^|; )".concat(e,"=([^;]*)")),r=document.cookie.match(t);return r?decodeURIComponent(r[1]):null}catch{for(var n=0,o=document.cookie.split("; ");n<o.length;n++){var s=o[n];if(s.startsWith(e+"="))return s.slice(e.length+1)}}return null}function Jt(e,t){document.cookie="".concat(e,"=").concat(t,"; Max-Age=34560000; Path=/; Secure; SameSite=None")+location.hostname.endsWith("memo.cool")?"; Domain=memo.cool":""}var p={os:null,fs:null,path:null,child_process:null,init:!1,initIfInNode:function(){return F(this,void 0,void 0,function(){var e,t,r,n;return V(this,function(o){switch(o.label){case 0:return ae&&!p.init?(e=p,[4,B(()=>import("./__vite-browser-external-BIHI7g3E.js"),[])]):[3,5];case 1:return e.os=o.sent(),t=p,[4,B(()=>import("./__vite-browser-external-BIHI7g3E.js"),[])];case 2:return t.fs=o.sent(),r=p,[4,B(()=>import("./__vite-browser-external-BIHI7g3E.js"),[])];case 3:return r.path=o.sent(),n=p,[4,B(()=>import("./__vite-browser-external-BIHI7g3E.js"),[])];case 4:n.child_process=o.sent(),o.label=5;case 5:return p.init=!0,[2]}})})}},he,ge;function Kt(){return!he&&ae&&(he={node_version:process.version.slice(1),os_username:S(function(){return p.os.userInfo().username},console.error),os_platform:S(function(){return p.os.platform()}),os_version:S(function(){return Xt()}),os_arch:S(function(){return p.os.arch()}),serial_number:S(function(){return Xe()}),hostname:S(function(){return p.os.hostname()})}),!ge&&He&&(ge={navigator:{userAgent:navigator.userAgent,connection:Wt(),language:navigator.language},get document(){return{referrer:document.referrer}},location:function(){var e=Q({},location);return delete e.ancestorOrigins,e}()}),{node_info:he,web_info:ge,logger_sdk_version:Vt,bi_uuid:Ht()}}var X;function Wt(){return X||(X={},S(function(){X=Qt(navigator.connection)})),X}function Qt(e){for(var t={},r=Object.keys(Object.getPrototypeOf(e)),n=0,o=r;n<o.length;n++){var s=o[n],a=e[s];(typeof a=="string"||typeof a=="boolean"||typeof a=="number")&&(t[s]=a)}return t}var Y="bi_uuid";function Ht(){if(ae)return Xe();var e=localStorage[Y]||Gt(Y)||Mt();return localStorage[Y]=e,Jt(Y,e),e}function Xe(){var e="",t=p.path.resolve(p.os.tmpdir(),"bi-logger.serial-number.txt");return S(function(){p.fs.existsSync(t)&&(e=p.fs.readFileSync(t).toString())}),e||(S(function(){var r,n="",o=p.os.platform();o==="darwin"?n=p.child_process.execSync("system_profiler SPHardwareDataType | grep Serial").toString().trim():o==="win32"?n=p.child_process.execSync("wmic bios get serialnumber").toString().trim():o==="linux"&&(n=p.child_process.execSync("dmidecode -t1 | grep Serial").toString().trim()),e=((r=n.match(/\s(\S+)$/))===null||r===void 0?void 0:r[1])||""}),S(function(){p.fs.writeFileSync(t,e)}),e)}function Xt(){var e="",t=p.path.resolve(p.os.tmpdir(),"bi-logger.os-version.txt");return S(function(){p.fs.existsSync(t)&&(e=p.fs.readFileSync(t).toString())}),e||(S(function(){var r,n=p.os.platform();if(n==="darwin")e=p.child_process.execSync("sw_vers -productVersion").toString().trim();else if(n==="win32")for(var o=p.child_process.execSync("systeminfo").toString().trim().split(/[\r\n]+/),s=0,a=o;s<a.length;s++){var u=a[s];if(u.includes("Build")){e=((r=u.match(/([\d.]+)/))===null||r===void 0?void 0:r[1])||"";break}}}),S(function(){p.fs.writeFileSync(t,e)}),e)}function Yt(e){return F(this,arguments,void 0,function(t){var r=t.env,n=t.path,o=t.body;return V(this,function(s){switch(s.label){case 0:return[4,(globalThis.fetch?Zt:er)({env:r,path:n,body:o})];case 1:return[2,s.sent()]}})})}function Zt(e){return F(this,arguments,void 0,function(t){var r,n=t.env,o=t.path,s=t.body;return V(this,function(a){switch(a.label){case 0:return[4,fetch("".concat(Qe(n)).concat(o),{method:"post",mode:"cors",credentials:"include",cache:"no-store",headers:{"content-type":"application/json"},body:s})];case 1:return r=a.sent(),[4,r.text()];case 2:return[2,a.sent()]}})})}function er(e){return F(this,arguments,void 0,function(t){var r,n,o=t.env,s=t.path,a=t.body;return V(this,function(u){switch(u.label){case 0:return r="".concat(Qe(o)).concat(s),[4,r.startsWith("https:")?B(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]):B(()=>import("./__vite-browser-external-BIHI7g3E.js"),[])];case 1:return n=u.sent(),[4,new Promise(function(l,c){var d=n.request(r,{method:"POST",headers:{"Content-Type":"application/json"}},function(f){var h="";f.on("data",function(x){h+=x}),f.on("end",function(){l(h)}),f.on("error",c)});d.write(a),d.end()})];case 2:return[2,u.sent()]}})})}function tr(e){e==null&&(e=Date.now());var t=new Date(e+1e3*3600*8).toISOString();return t.slice(0,10)+" "+t.slice(11,19)}function rr(e){function t(u){return u===null?"null":typeof u}if(Object(e)!==e)throw new Error("入参应为对象, 而非 ".concat(t(e)));if(e.logLevel&&!["silent","error","warn","info","log"].includes(e.logLevel))throw new Error("logLevel 参数指定有误");var r=e.logLevel||"error",n=Ft(r),o=e.env||E.prod;if(!qt(o))throw new Error("env 参数指定时应为 ".concat(E.prod," | ").concat(E.prt," | ").concat(E.local));if(typeof e.project_id!="string")throw new Error("project_id 参数类型应为 string, 而非 ".concat(t(e.project_id)));if(!e.project_id)throw new Error("project_id 参数不能为空");var s={get client_create_time(){return Date.now()},get project_id(){return e.project_id},get custom_info(){return e.custom_info},get username(){return e.username}};function a(u,l){return F(this,void 0,void 0,function(){var c,d,f,h;return V(this,function(x){switch(x.label){case 0:return p.init?[3,2]:[4,p.initIfInNode()];case 1:x.sent(),Object.assign(s,Kt()),x.label=2;case 2:if(x.trys.push([2,4,,5]),typeof u!="string")throw new Error("log_type 参数类型应为 string, 而非 ".concat(typeof u));if(!u)throw new Error("log_type 参数不能为空");return c=Q(Q({},s),{log_type:u,log_data:l}),d=JSON.stringify(c,null,4),n.log(tr(),"上报 ".concat(o," 环境日志"),d),f=void 0,[4,Yt({env:o,path:"/api/bi/record",body:d})];case 3:f=x.sent();try{return[2,JSON.parse(f)]}catch{return[2,{result:0,message:f}]}return[3,5];case 4:return h=x.sent(),[2,{result:0,message:String(h)}];case 5:return[2]}})})}return a("__init__").catch(n.error),nr(a).catch(n.error),{sendLog:a}}function nr(e){return F(this,void 0,void 0,function(){return V(this,function(t){return He?(document.addEventListener("visibilitychange",function(r){r.isTrusted&&e("__visibilitychange__",document.visibilityState).catch(console.error)}),[2]):[2]})})}const or=rr({project_id:location.hostname});function J(e,t){location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.port!==""||or.sendLog(e,t)}const ir={activeTab(e){J("ui:active-tab",{key:e})}},j={click(e){J("url:click",{name:e})},qrCodeError(e){J("url:qrCodeError",e)},upgradeLocalStorageToIndexDB(){J("url:upgradeLocalStorageToIndexDB")},readSharingLink(e){J("url:readSharingLink",e)}};async function Ye(e,t=""){await sr(e)?m.success(t||"已复制"):m.error("复制失败")}let R=null,M=null,N=null;async function sr(e){var r,n,o;(r=globalThis==null?void 0:globalThis.document)!=null&&r.readyState&&(R||(R=document.createElement("div"),R.style.zIndex="1234567809",R.style.position="fixed",R.style.opacity="0"),M||(M=document.createRange()),N||(N=document.getSelection()));let t=!1;if((n=globalThis==null?void 0:globalThis.navigator)!=null&&n.clipboard)try{await navigator.clipboard.writeText(e),t=!0}catch{}return(o=globalThis==null?void 0:globalThis.document)!=null&&o.readyState&&R&&M&&N&&(R.innerText=e,document.body.appendChild(R),M.selectNodeContents(R),N&&(N.removeAllRanges(),N.addRange(M),t=t||!!(document!=null&&document.execCommand("copy")),R.remove())),t}class ar{constructor(t){L(this,"maxSize");L(this,"map",new Map);L(this,"_keys",[]);this.maxSize=Math.max(t,1)}get size(){return this.map.size}set(t,r){if(this._deleteKey(t),this.map.delete(t),this.map.size>=this.maxSize){const n=this._keys.shift();this.map.delete(n)}return this._keys.push(t),this.map.set(t,r),this}delete(t){this.map.delete(t),this._deleteKey(t)}get(t){return this.map.get(t)}has(t){return this.map.has(t)}clear(){this._keys.length=0,this.map.clear()}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}forEach(...t){this.map.forEach(...t)}_deleteKey(t){const r=this._keys.lastIndexOf(t);r!==-1&&this._keys.splice(r,1)}}const me=new ar(12);function cr(e){return me.has(e)?me.get(e):new Promise(t=>{const r=new FileReader;r.onload=n=>{var s;const o=((s=n.target)==null?void 0:s.result)||"";me.set(e,o),t(o)},r.readAsDataURL(e)})}async function lr(e){return new Promise(async(t,r)=>{try{const n=new Image;n.onerror=o=>{r(o)},n.onload=()=>{t(n)},n.src=await cr(e)}catch(n){r(n)}})}function ur(e,t){const r=document.createElement("canvas"),n=r.getContext("2d");return r.width=e.width,r.height=e.height,n.fillStyle=t,n.fillRect(0,0,e.width,e.height),n.drawImage(e,0,0),r}const I=class I{constructor(){L(this,"managerRound",0)}static reset(t){const r=I.for(t);return r.cancelAllContext(),r.getContext()}static for(t){return I.keyToManager[t]||(I.keyToManager[t]=new I),I.keyToManager[t]}cancelAllContext(){++this.managerRound}getContext(){const t=this.managerRound;return{manager:this,isCancellationRequested:()=>t!==this.managerRound}}};L(I,"keyToManager",{});let je=I;function dr(e){return new Promise((t,r)=>{e.toBlob(n=>{n?t(n):r(new Error("Canvas toBlob returned null"))},"image/png")})}function Ze(e,t="",r=""){let n="";if(typeof e=="string")n=e;else{const o=`${String(e)}`;n=`${t?t+(o?": ":""):""}${o}`}ht.error({content:n,duration:3e3,id:r})}async function fr(){try{const e=document.querySelector("canvas");if(!e){m.error("无内容");return}const t=await dr(e);await navigator.clipboard.write([new ClipboardItem({[t.type]:t})]),m.success("已复制")}catch(e){Ze(e,"复制失败")}}async function hr(e=!1){try{const t=je.reset("readTextFromClipboard"),r=await navigator.clipboard.read();if(t.isCancellationRequested())return;for(let n of r)for(let o of n.types)if(o==="image/png"){let s;const a=await n.getType(o),u=await lr(a),l=ur(u,"#fff");s=l.getContext("2d").getImageData(0,0,l.width,l.height);const d=gt(s.data,s.width,s.height);return d!=null&&d.data?(m.success("成功解析剪贴板二维码"),d.data):(m.error("无法识别剪贴板中的图片"),null)}else if(!e&&o==="text/plain"){const s=await n.getType(o);if(t.isCancellationRequested())return;const a=await s.text();return t.isCancellationRequested()?void 0:(a?m.success("已读取剪贴板文本"):m.warning("剪贴板为空字符串"),a)}e||m.warning("剪贴板为空")}catch(t){Ze(t,"读取失败")}return null}let pe;function ce(){var e,t;try{if(typeof((e=globalThis.crypto)==null?void 0:e.randomUUID)=="function")return crypto.randomUUID();if(typeof((t=globalThis.URL)==null?void 0:t.createObjectURL)=="function"&&globalThis.Blob){pe||(pe=new Blob);const r=URL.createObjectURL(pe),n=r.slice(-36);return URL.revokeObjectURL(r),n}}catch{}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const n=Math.random()*16|0;return(r=="x"?n:n&3|8).toString(16)})}const le={order:0,id:"",name:"",text:"",json:"",qrCodeSize:300,jsonSpaceIndent:8,jsonResultDecodeURIComponent:!0,createTime:0,modifiedTime:0,notes:""};Object.freeze(le);function gr(){return{...le,id:ce(),createTime:Date.now(),modifiedTime:Date.now()}}function et(e){const t=gr();for(let[r,n]of Object.entries(t)){const o=e[r];n!==o&&typeof n==typeof o&&(t[r]=o)}return t}const mr=Object.entries(le);function D(e){const t={};for(let[r,n]of mr){const o=e[r];n!==o&&typeof n==typeof o&&(t[r]=o)}return t}const Be={source:""},re={_key:"urlToolStateCache",read:()=>JSON.parse(localStorage[re._key])};function tt(){try{let e=re.read();if(Object(e)!==e&&(e={}),!Array.isArray(e.projects)&&Array.isArray(e.items)&&(e.projects=e.items,delete e.items),Array.isArray(e.projects)||(e.projects=[]),e.projects.length)for(let t of e.projects){t.id=String(t.id||ce());for(let[r,n]of Object.entries(le))typeof t[r]!=typeof n&&(t[r]=n)}Object(e.config)!==e.config&&(e.config={});for(let[t,r]of Object.entries(Be))typeof e.config[t]!=typeof r&&(e.config[t]=r);for(let[t,r]of e.projects.entries())r.order=t;return e}catch{}return{projects:[],config:{...Be}}}function pr(e,t,r){return e>=t||(e=t),e<=r||(e=r),e}function rt(e){return new Promise((t,r)=>{e.onerror=r,e.onsuccess=function(n){t(e.result)}})}function nt({dbName:e,dbVersion:t,objectStoreName:r,onData:n,keyPath:o}){const s=indexedDB.open(e,t);s.onerror=function(b){throw setTimeout(x),s.error.name==="VersionError"&&indexedDB.deleteDatabase(e),s.error};const a="db-on-block";s.onblocked=function(b){throw setTimeout(()=>{A.error({key:a,message:"请关闭其它标签页",description:"其它标签页的数据库版本过旧",duration:-1,closable:!1})}),s.error},s.onupgradeneeded=function(b){const C=this.result;C.objectStoreNames.contains(r)&&C.deleteObjectStore(r),C.createObjectStore(r,{keyPath:o}),e==="urlToolStateCache"&&(C.objectStoreNames.contains("config")&&C.deleteObjectStore("config"),C.createObjectStore("config"))},s.onsuccess=function(b){u=this.result,f(),A.destroy(a),u.onclose=function(C){console.log("db.onclose",C),u=null},u.onversionchange=function(){u.close(),l="本页面的数据库版本过旧, 请切换到新页面使用。",u=null,A.error({message:l,duration:-1,closable:!1})}};let u=null,l="本地数据库异常";const c=new BroadcastChannel(`${e}.${t}`),d="db_change";c.onmessage=async function(b){u&&b.data===d&&await f()};async function f(){const b=await rt(h({broadcast:!1}).getAll());n(b)}function h({broadcast:b,name:C=r}){u||x();const Ie=u.transaction([C],"readwrite"),lt=Ie.objectStore(C);return b&&Ie.addEventListener("complete",()=>c.postMessage(d)),lt}function x(){A.error({key:`db-${e}-error`,message:l,description:"刷新可能导致数据丢失，建议新开页面手动迁移数据，完成后关闭本页。",duration:-1,closable:!0,btn:i.jsxs(y,{children:[i.jsx("a",{href:location.href,target:"_blank",children:i.jsx(v,{color:"primary",variant:"filled",children:"新开页面"})}),i.jsx(v,{color:"danger",variant:"filled",onClick:()=>{location.reload()},children:"刷新本页面"})]})})}return{getObjectStore:h}}function xr(){let e=0;return{reset(){e=0},input(t){t>e&&(e=t)},next(){return++e}}}function vr(){let e=0;return{reset(){e=0},input(t){t<e&&(e=t)},next(){return--e}}}const O=nt({dbName:"urlToolStateCache",dbVersion:1,objectStoreName:"projects",keyPath:"id",onData(e){const t=O.getObjectStore({broadcast:!1}),r=O.getObjectStore({broadcast:!1,name:"config"});{let n;localStorage[re._key]&&(n=tt(),delete localStorage[re._key],j.upgradeLocalStorageToIndexDB());{e.sort((o,s)=>o.order-s.order);for(let[o,s]of e.entries()){const a=s.order;s.order=o,a!==s.order&&t.put(s)}if(n){const o=new Set;if(e.forEach(s=>o.add(s.id)),n.projects.length)for(let s of n.projects)o.has(s.id)||(s.order=e.length,e.push(s),t.put(s));n.config.source&&r.put(n.config.source,"source")}}}$e(n=>{n.projects=e.map(o=>et(o)),ne.reset(),ne.input(n.projects.length)}),rt(r.get("source")).then(n=>{$e(o=>{o.config.source=n||""})});{const n=new URL(location.href),o=n.searchParams.get(be);if(o)try{const s=JSON.parse(o);if(s===Object(s)){ie.dispatch(oe.actions.delete({id:s.id,ignorePrompt:!0})),ie.dispatch(oe.actions.add(s)),m.success("已读取分享链接"),j.readSharingLink({status:"success"}),_e.add(s.id),we.delete(s.id),n.searchParams.delete(be);const a=n.toString();window.history.replaceState({},document.title,a)}}catch(s){console.error(s),m.error("无法识别分享链接"),j.readSharingLink({status:"fail"})}}}}),be="share_url",_e=new Set,we=new Set;function yr(e){let t=pt(D(e),["id","text","notes","name"]);const r=JSON.stringify(t),n=new URL(location.href);n.searchParams.set(be,r);const o=n.toString();Ye(o,"分享链接已复制到剪贴板")}const ne=vr(),oe=Me({name:"url_tool",initialState:tt,reducers:{updateState(e,t){t.payload(e)},updateConfigEntry(e,{payload:t}){e.config[t.key]=t.value,O.getObjectStore({broadcast:!1,name:"config"}).put(t.value,t.key)},updateProjectEntry(e,{payload:t}){const{projects:r}=e,n=r.find(o=>o.id===t.id);if(!n){m.error("项目未找到");return}n[t.key]=t.value,n.modifiedTime=Date.now(),O.getObjectStore({broadcast:!0}).put(D(G(n)))},add(e,{payload:t={}}){t=t||{};const{projects:r}=e,n=et(t);n.order=ne.next(),r.unshift(n),O.getObjectStore({broadcast:!0}).add(D(n))},rename(e,t){const{projects:r}=e,n=t.payload.newName.trim(),o=r.find(s=>s.id===t.payload.id);if(!o){m.error("项目未找到");return}n&&r.some(s=>s.name===n&&s.id!==t.payload.id)&&m.warning("与其他项目重名"),n?o.name?m.success(`项目重命名: ${o.name} ⮕ ${n}`):m.success(`已设置项目名: ${n}`):m.success("已清除项目名, 可重新设置"),o.name=n,o.modifiedTime=Date.now(),O.getObjectStore({broadcast:!0}).put(D(G(o)))},move(e,t){const{projects:r}=e,n=r.findIndex(c=>c.id===t.payload.id),o=r[n];if(!o){m.error("项目未找到");return}let s=n+t.payload.indexOffset;if(s=pr(s,0,r.length-1),s===n)return;r.splice(n,1),r.splice(s,0,o);const[a,u]=[r[s],r[n]];[a.order,u.order]=[u.order,a.order];const l=O.getObjectStore({broadcast:!0});l.put(D(G(a))),l.put(D(G(u)))},clone(e,{payload:t}){const{projects:r}=e,n=r.findIndex(c=>c.id===t.id);if(n===-1){m.error("项目未找到");return}const o=r[n];function s(){var f;let c=o.name;const d=(f=c.match(/^(.+)_副本\d*$/))==null?void 0:f[1];d&&(c=d);for(let h=1;;h++){let x=c+"_副本"+(h===1?"":h);if(!r.some(b=>b.name===x))return x}}const a={...structuredClone(mt(o)),id:ce(),name:s()};r.splice(n,0,a);const[u,l]=[r[n-1],r[n+1]];a.order=u?(u.order+l.order)/2:ne.next(),m.success(`已复制为: ${a.name}`),O.getObjectStore({broadcast:!0}).add(D(a))},delete(e,{payload:t}){const r=e.projects.find(n=>n.id===t.id);if(!r){t.ignorePrompt||m.error("项目未找到");return}t.ignorePrompt||m.success("已删除"),e.projects.splice(e.projects.indexOf(r),1),O.getObjectStore({broadcast:!0}).delete(r.id)}}}),k=oe.actions,ie=Ge({reducer:oe.reducer,middleware:e=>e({serializableCheck:{ignoredActions:["url_tool/updateState"]}})}),H=Je,ot=Ke;function $e(e){ie.dispatch(k.updateState(t=>{e(t)}))}function it(){const e=H(),t=ot(r=>r.config);return new Proxy(function(){},{get(r,n,o){return t[n]},set(r,n,o){return e(k.updateConfigEntry({key:n,value:o})),!0}})}function st(e){const t=H();return new Proxy(function(){},{get(r,n,o){return e[n]},set(r,n,o){return t(k.updateProjectEntry({key:n,id:e.id,value:o})),!0}})}const jr=e=>{const t=H(),[r,n]=g.useState(e.project.name);g.useEffect(()=>{n(e.project.name)},[e.project.name]);function o(){r!==e.project.name&&t(k.rename({id:e.project.id,newName:r}))}return i.jsxs(w,{gap:8,justify:"right",align:"center",className:"project-header",children:[i.jsx(T,{variant:"filled",size:"small",placeholder:"输入新的项目名",value:r,onChange:s=>n(s.target.value),onBlur:o,onPressEnter:o,suffix:i.jsx(i.Fragment,{})}),_e.has(e.project.id)&&i.jsx(i.Fragment,{children:i.jsx(y,{className:"op-left",children:i.jsx(xt,{bordered:!1,style:{backgroundColor:"transparent",color:"#0ae"},children:"* 此项目从分享链接导入"})})}),i.jsxs(y,{className:"op-buttons",children:[i.jsx(ve,{placement:"top",title:"创建分享链接",children:i.jsx(v,{size:"small",variant:"filled",color:"default",icon:i.jsx(vt,{}),onClick:()=>{j.click("share-project"),yr(e.project)},children:"分享"})}),i.jsx(v,{size:"small",variant:"filled",color:"default",icon:i.jsx(yt,{}),onClick:()=>{j.click("clone-project"),t(k.clone({id:e.project.id}))},children:"克隆"}),i.jsx(v,{size:"small",variant:"filled",color:"danger",icon:i.jsx(jt,{}),onClick:()=>{j.click("delete-project"),t(k.delete({id:e.project.id}))},children:"删除"}),i.jsx(v,{size:"small",variant:"filled",color:"default",icon:i.jsx(bt,{}),onClick:()=>{j.click("move-up-project"),t(k.move({id:e.project.id,indexOffset:-1}))},children:"上移"}),i.jsx(v,{size:"small",variant:"filled",color:"default",icon:i.jsx(wt,{}),onClick:()=>{j.click("move-down-project"),t(k.move({id:e.project.id,indexOffset:1}))},children:"下移"})]})]})};function br(e){const t=[];for(let r of e.split(`
`))r=r.split("#")[0],r=r.trim(),r&&t.push(r);return t}function wr(e){const t=new Set,r=new Set,n=new Map;let o=!1;for(let a of br(e))try{let u=!1,l=!1,c=!1,d;if(a==="/"?o=!0:a[0]==="?"||a[0]==="/"?(l=a[0]==="/",c=!0,d=new URL("http://host"+a)):(u=l=c=!0,d=new URL(a)),u&&t.add(d.origin),l&&r.add(d.pathname),c)for(let f of d.searchParams.keys()){const h=n.get(f)||new Set;for(let x of d.searchParams.getAll(f))h.add(x);n.set(f,h)}}catch{}o||r.delete("/");const s=[];for(let a of[...n.keys()].sort()){const u=n.get(a);u&&s.push([a,[...u].sort()])}return Object.freeze({origins:[...t].sort(),paths:[...r].sort(),queries:s})}const Sr=({text:e,updateText:t})=>{const r=it(),n=g.useMemo(()=>wr(r.source),[r.source]),o=g.useRef(""),s=g.useMemo(()=>{if(o)try{const c=new URL(e);return o.current=c.toString(),c}catch{return null}},[e]);function a(c){const d=o.current.replace(s.origin,c);d!==e&&t(d)}function u(c){try{const d=o.current.replace(s.pathname,c);d!==e&&t(d)}catch{}}function l(c,d){try{const f=new URL(s);d===void 0?f.searchParams.delete(c):f.searchParams.set(c,d);const h=f.toString();h!==e&&t(h)}catch{}}return s&&(n.origins.length>0||n.paths.length>0||n.queries.length>0)&&i.jsxs(w,{wrap:!0,gap:8,className:"query-entry-c17f1a8e",children:[n.origins.length>0&&i.jsxs(w,{vertical:!0,gap:8,children:[i.jsx("div",{className:"sub-title",children:"Origin 替换"}),n.origins.map(c=>i.jsx("div",{children:i.jsx(v,{size:"small",variant:"filled",color:c===s.origin?"primary":"default",onClick:()=>{j.click("replace-origin"),a(c)},children:c})},c))]}),n.paths.length>0&&i.jsxs(w,{vertical:!0,gap:8,children:[i.jsx("div",{className:"sub-title",children:"Path 替换"}),n.paths.map(c=>i.jsx("div",{children:i.jsx(v,{size:"small",variant:"filled",color:c===s.pathname?"primary":"default",onClick:()=>{j.click("replace-path"),u(c)},children:c})},c))]}),n.queries.length>0&&i.jsxs(w,{vertical:!0,gap:8,className:"query-entries",children:[i.jsx("div",{className:"sub-title",children:"Query 替换"}),i.jsx(w,{wrap:!0,gap:8,style:{padding:"0 8px 9px"},children:n.queries.map(([c,d])=>i.jsxs(w,{gap:4,style:{padding:8},className:"query-entry",justify:"flex-start",children:[i.jsxs("div",{children:[c,":"]}),i.jsx(w,{gap:4,wrap:!0,children:d.map(f=>{const h=s.searchParams.get(c)===f;return i.jsx("div",{children:i.jsx(v,{size:"small",variant:"filled",color:h?"primary":"default",onClick:()=>{j.click("replace-query"),l(c,h?void 0:f)},style:{textAlign:"left"},children:i.jsx("div",{style:{maxWidth:"100%",whiteSpace:"wrap"},children:f})},f)},f)})})]},c))})]})]})},Cr=g.memo(Sr,(e,t)=>e.text===t.text);function ze(e){const t=new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1,weekday:"short"}).replace(/\//g,"-");return t.slice(0,10)+" "+t.slice(10)}const Er=e=>{H();const t=st(e.project);return i.jsxs(w,{gap:16,className:"project-footer",children:[i.jsxs("div",{children:["创建于: ",ze(t.createTime)]}),i.jsxs("div",{children:["修改于: ",ze(t.modifiedTime)]})]})},W="$quote",Se="$json",q="$base",se="$params",Ce="$base64",Z="$time",K="$length",ee="$type",at={link2json(e,t){const r=P(e);return typeof r=="string"?r:JSON.stringify(r,null,t)},json2link(e){let t=e;try{t=JSON.parse(t),"url"in t&&"params"in t&&(t={[q]:t.url,[se]:t.params})}catch{}const r=U(t);return typeof r=="string"?r:JSON.stringify(r,null,4)}};function P(e){if(Object(e)===e){if(Array.isArray(e))return e.map(a=>P(a));{const a={};for(let[u,l]of Object.entries(e))a[u]=P(l);return a}}{let a=function(l,c){c===10&&(l*=1e3);let d=new Date(l).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-");const f=l%1e3;return f>0&&(d+="."+f),d};const u=typeof e;if(u==="string"||u==="number"){const l=Number(e),c=String(e);if((c.length===10||c.length===13)&&(c.length===10?/^\d{10}$/:/^\d{13}$/).test(c))return{[Z]:a(l,c.length),[ee]:u,[K]:c.length}}}if(typeof e!="string")return e;try{let a=atob(e);return JSON.parse(a),{[Ce]:P(a)}}catch{}try{{const d=e.replaceAll(" ","");if(d==="{}"||d==="[]")return e}let a="",u=e;(e[0]==='"'&&e[e.length-1]==='"'||e[0]==="'"&&e[e.length-1]==="'")&&(a=e[0],u=e.slice(1,-1));let l=JSON.parse(u);if(Object(l)!==l&&typeof l!="string"&&!a)return e;l=P(l);const c={[W]:a,[Se]:l};return c[W]||delete c[W],c}catch{}let t="",r=Object.create(null),n,o;try{n=new URL(e),o=n.searchParams}catch{let u=e;const l=e.indexOf("?"),c=e.indexOf("=");if(l!==-1&&c!==-1)t=e.slice(0,l),u=e.slice(l);else return e;o=new URLSearchParams(u)}finally{}if(n){const a=new URL(n);a.search="",t=a.toString()}if((o==null?void 0:o.size)>0)for(let[a,u]of[...o.entries()]){const l=r[a];l===void 0?r[a]=u:typeof l=="string"?r[a]=[l,u]:Array.isArray(l)&&l.push(u)}else return e;r=P(r);const s={[q]:t,[se]:r};return s[q]||delete s[q],s}function U(e){if(Object(e)!==e)return e;{const t=Z in e,r=ee in e,n=K in e;if(t&&r&&n){const o=e[Z],s=e[ee],a=Number(e[K]);if(!(a<=13))throw new Error(`${K}(${e[K]}) should be 10 | 13`);if(s!=="string"&&s!=="number")throw new Error(`${ee}(${s}) should be "string" | "number"`);let l=new Date(o).getTime();if(Number.isNaN(l))throw new Error(`${Z}(${o}) is not a valid date time string`);return l/=10**(13-a),s==="string"?String(l):l}}if(Ce in e){let r=e[Ce];if(r=U(r),typeof r!="string")throw new Error(`${r} is not a string and cannot be converted to base64`);return btoa(r)}{const t=W in e,r=Se in e;if(t||r){let n;if(n=e[Se],n=U(n),n=JSON.stringify(n),t){const o=e[W];n=o+n+o}return n}}{const t=q in e,r=se in e;if(t||r){let n="";if(r){const o=e[se],s=new URLSearchParams;for(let[a,u]of Object.entries(o)){const l=U(u);if(typeof l=="string")s.set(a,l);else if(Array.isArray(l))for(let c of l)s.append(a,c);else throw new Error("IllegalCase")}n=s.toString()}if(t){const o=e[q];try{const s=new URL(o);return s.search=n,s.toString()}catch{return o+"?"+n}}else return n}}{if(Array.isArray(e))return e.map(t=>U(t));{const t={};for(let[r,n]of Object.entries(e))t[r]=U(n);return t}}}class Tr extends g.Component{constructor(){super(...arguments);L(this,"state",{hasError:!1,errorMessage:"组件报错"})}static getDerivedStateFromError(r){return{hasError:!0}}componentDidCatch(r,n){{let s="";r instanceof Error?s={name:r.name,stack:r.stack,message:r.message}:s=String(r),j.qrCodeError({error:s,errorInfo:n})}let o=(r==null?void 0:r.message)||"生成二维码失败";o==="Data too long"&&(o="数据过大, 无法生成二维码"),this.setState({errorMessage:o})}render(){return this.state.hasError?i.jsx("div",{style:{color:"#f12",fontWeight:"bold"},children:this.state.errorMessage}):this.props.children}}function _r(e){let t=at.link2json(e.text,e.jsonSpaceIndent);return e.jsonResultDecodeURIComponent&&(t=decodeURIComponent(t)),t}function Rr(e){return at.json2link(e.json)}const Or=g.memo(e=>{const t=st(e.project),r=g.useRef(void 0),[n,o]=g.useState(""),[s,a]=g.useState(""),u=function(c=!1){if(!c&&r.current!=="text2json")return;o("");const d=t.text.trim();if(d)try{t.json=_r({text:d,jsonSpaceIndent:t.jsonSpaceIndent,jsonResultDecodeURIComponent:t.jsonResultDecodeURIComponent})}catch(f){o("输入非 URL: "+f)}};return g.useEffect(()=>{_e.has(t.id)&&!we.has(t.id)&&(we.add(t.id),u(!0))},[t.id]),g.useEffect(u,[t.text,t.jsonSpaceIndent,t.jsonResultDecodeURIComponent]),g.useEffect(()=>{if(r.current!=="json2text")return;a("");const l=t.json.trim();if(l)try{t.text=Rr({json:l})}catch(c){a("输入非法: "+c)}},[t.json]),i.jsxs("div",{className:"project-19DCD952-8A43",children:[i.jsx(jr,{project:e.project}),i.jsxs(ue,{className:"project-content",children:[i.jsx(ue.Panel,{className:"text-area",defaultSize:"50%",min:"20%",max:"80%",children:i.jsxs(y,{onPointerDown:()=>{r.current="text2json"},size:"middle",direction:"vertical",style:{width:"100%"},children:[i.jsxs(y,{children:[i.jsx("div",{className:"title",children:"URL 文本"}),t.text&&i.jsx(i.Fragment,{children:i.jsx(v,{variant:"filled",color:"primary",onClick:()=>{j.click("copy-text"),Ye(t.text)},icon:i.jsx(St,{}),children:"复制文本"})})]}),i.jsx(T.TextArea,{onClick:function(l){const c=l.target;if(!c.select)return;const d="__is_selected_0";c[d]||(c[d]=!0,c.select(),c.onblur=()=>{delete c[d],c.onblur=null})},value:t.text,onChange:l=>{var d;let c=l.target.value.trim();if(Math.abs(c.length-t.text.length)>=2)try{const f=(d=c.match(/^['"\s]*([^'"\s]+)['"\s]*$/))==null?void 0:d[1];f&&(new URL(f),c=f)}catch{}t.text=c},status:n?"error":void 0,allowClear:!0,style:{width:"100%",maxHeight:"calc(40vh)",overflowY:"auto"},autoSize:{minRows:2},onPaste:async l=>{const c=await hr(!0);c&&(t.text=c||"")},placeholder:"支持粘贴二维码"}),n&&i.jsx(Le,{closable:!0,type:"error",content:n}),t.text&&i.jsxs(w,{gap:16,children:[i.jsxs(y,{direction:"vertical",children:[i.jsx("div",{children:i.jsxs(y,{children:[i.jsx("div",{className:"title",children:"二维码"}),i.jsx(v,{variant:"filled",color:"primary",onClick:()=>{fr(),j.click("copy-qr-code")},icon:i.jsx(Ct,{}),children:"复制二维码"})]})}),i.jsxs(y,{children:[i.jsx("span",{style:{whiteSpace:"nowrap"},children:"尺寸:"}),i.jsx("div",{style:{width:"50px"},children:t.qrCodeSize+"px"}),i.jsx(ye,{tooltip:{placement:"bottom"},style:{width:"10em"},value:t.qrCodeSize,onChange:l=>{t.qrCodeSize=l},min:100,max:600})]}),i.jsx(Tr,{children:i.jsx(Et,{size:t.qrCodeSize,value:t.text})})]}),i.jsx(Cr,{text:t.text,updateText:l=>t.text=l})]})]})}),i.jsxs(ue.Panel,{className:"json-area",children:[i.jsx(y,{direction:"vertical",children:i.jsx("div",{className:"title",children:"备注"})}),i.jsx(T.TextArea,{value:t.notes,onChange:l=>{t.notes=l.target.value},style:{width:"100%",marginBottom:"12px",marginTop:"6px"},autoSize:{minRows:1}}),i.jsxs(y,{onPointerDown:()=>{r.current="json2text"},size:"middle",direction:"vertical",style:{width:"100%"},children:[i.jsxs(y,{children:[i.jsx("div",{className:"title",children:"JSON 格式"}),i.jsx(ve,{title:"缩进空格数",children:i.jsx(i.Fragment,{children:i.jsx(ye,{tooltip:{placement:"bottom"},style:{width:"10em"},value:t.jsonSpaceIndent,onChange:l=>{t.jsonSpaceIndent=l,r.current="text2json"},min:0,max:10})})}),i.jsx(ve,{title:"解码后调用一次 DecodeURIComponent",children:i.jsx(i.Fragment,{children:i.jsxs(Tt,{checked:t.jsonResultDecodeURIComponent,onChange:l=>{t.jsonResultDecodeURIComponent=l.target.checked,r.current="text2json"},children:[" ","Decode Once"," "]})})})]}),i.jsx(T.TextArea,{status:s?"error":void 0,value:t.json,onChange:l=>{t.json=l.target.value},style:{width:"100%",maxHeight:"calc(40vh + 100px)"},autoSize:{minRows:2}}),s&&i.jsx(Le,{closable:!0,type:"error",content:s})]})]})]}),i.jsx(Er,{project:e.project})]})}),kr=e=>{const t=H();function r(){j.click("add-project"),t(k.add())}return i.jsx("div",{className:"project-adder",children:i.jsx(w,{justify:"center",align:"center",gap:8,children:i.jsx(v,{variant:"filled",color:"default",icon:i.jsx(_t,{}),onClick:r,children:"新增项目"})})})},Ir=()=>{const e=it(),[t,r]=g.useState(4);return i.jsxs("div",{className:"project-config",children:[i.jsx("div",{className:"title",children:"全局配置"}),i.jsxs(w,{gap:8,align:"center",children:[i.jsx("div",{children:"快捷替换来源:"}),i.jsx("div",{style:{flexGrow:1},children:i.jsx(T.TextArea,{onBlur:()=>r(4),onFocus:()=>r(void 0),value:e.source,onChange:n=>{e.source=n.target.value},allowClear:!0,style:{width:"100%"},autoSize:{minRows:2,maxRows:t},placeholder:`http://127.0.0.1:3000         # localhost
https://test.example.com # Test Environment
/some/path
?type=1&type=2`})})]}),i.jsxs("div",{children:[i.jsx("div",{children:"输入多条链接（可省略 origin），以换行符分隔，每行 # 号后面的内容会被忽略。"}),i.jsx("div",{children:"输入的 host, path, query 等会被解析为所有项目 URL 各部分快速替换的可选项。"})]})]})},Lr=()=>{const e=ot(t=>t.projects);return i.jsxs("div",{className:"url-tool",children:[i.jsx(Ir,{}),i.jsx(kr,{}),e.map(t=>i.jsx(Or,{project:t},t.id))]})},Re=()=>i.jsx(i.Fragment,{children:i.jsx(We,{store:ie,children:i.jsx(Lr,{})})});Re.title="URL格式化";Re.key="URL Tool";const qe="2023/04/16::svg-tool::svgXmlText";function Dr(e){e.setAttribute("viewBox",`0,0,${e.getBBox().width+2},${e.getBBox().height+2}`),e.style.width="100%",e.style.height="auto"}const Oe=()=>{const[e,t]=g.useState({width:"",height:"",scale:"4"}),[r,n]=g.useState(""),[o,s]=g.useState(sessionStorage[qe]||"");g.useEffect(()=>{try{sessionStorage[qe]=o}catch(f){console.error(f),sessionStorage.clear(),m.error("本地缓存已满。暂不影响业务功能，但关闭标签页后数据丢失。")}},[o]);const[a,u]=g.useState(null);g.useLayoutEffect(()=>{var f;if(n(""),u(null),o.length!==0)try{const h=((f=l.current)==null?void 0:f.querySelector("svg"))||null;u(h),h||n("请指定 svg 文本: <svg ...")}catch(h){n(String(h))}},[o]);const l=g.useRef(null);g.useEffect(()=>{try{a&&Dr(a)}catch{n("svg 文本有误。")}},[a]);function c(){if(!a){m.error("svg 未就绪。");return}const f=e.width.length===0?null:Number(e.width),h=e.height.length===0?null:Number(e.height);if(e.width.length>0&&Number.isNaN(f)){m.error("width 应为数字, 或留空。");return}if(e.height.length>0&&Number.isNaN(h)){m.error("height 应为数字, 或留空。");return}if(f&&f<0){m.error("width 不能小于 0 。");return}if(h&&h<0){m.error("height 不能小于 0 。");return}const x=Number(e.scale)||null;Ut(a,{width:f,height:h,scale:x})}async function d(){c()}return i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:".618rem",padding:".618rem",backgroundColor:"#f4f4f4"},children:[i.jsx(te,{title:i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("div",{children:"输入 Svg 源码"}),i.jsx("div",{style:{fontSize:"1rem",fontWeight:"normal"},children:i.jsx(i.Fragment,{})})]}),children:i.jsxs(y,{direction:"vertical",style:{width:"100%"},children:[i.jsx(T.TextArea,{onChange:f=>{s(f.target.value)},style:{width:"100%"},autoSize:{minRows:4,maxRows:4},value:o,status:r?"error":"",allowClear:!0}),i.jsx("div",{ref:l,className:"SvgContainerDiv",dangerouslySetInnerHTML:{__html:function(){const f=o.indexOf("<svg");return f!==-1?o.slice(f):""}()}}),r&&i.jsx(Ve,{message:r,description:null,type:"error",showIcon:!0,style:{whiteSpace:"pre-wrap"}})]})})," ",i.jsxs(te,{title:i.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:i.jsx("div",{children:"导出为图片"})}),children:[i.jsx(z.Item,{label:"width",help:i.jsx(i.Fragment,{children:"只需指定宽度或高度的一个参数，另一个参数将会自动计算得出。"}),children:i.jsx(T,{value:e.width,onChange:f=>{t({...e,width:f.target.value.trim()})},status:e.width.length>0&&Number.isNaN(Number(e.width))?"error":"",allowClear:!0})}),i.jsx(z.Item,{label:"height",children:i.jsx(T,{value:e.height,onChange:f=>{t({...e,height:f.target.value.trim()})},status:e.height.length>0&&Number.isNaN(Number(e.height))?"error":"",allowClear:!0})}),i.jsx(z.Item,{label:"scale",children:i.jsx(ye,{min:1,max:10,step:1,onChange:f=>{t({...e,scale:String(f||"")})},value:Number(e.scale),tooltip:{open:!0}}),help:i.jsx(i.Fragment,{children:"缩放是无损的。"})}),i.jsx("div",{style:{fontSize:"1rem",fontWeight:"normal",paddingTop:".618rem"},children:i.jsx(i.Fragment,{children:i.jsx(y,{children:i.jsx(v,{onClick:d,children:"保存"})})})})]})]})};Oe.title="Svg";Oe.key="Svg";function Nr(e){return e<10||e<100||e<1e3?"":e<1e4?"千":e<1e5?"万":e<1e6?"十万":e<1e7?"百万":e<1e8?"千万":e<1e9?"亿":e<1e10?"十亿":e<1e11?"百亿":e<1e12?"千亿":e<1e13?"万亿":e<1e14?"十万亿":e<1e15?"百万亿":e<1e16?"千万亿":""}function Fe(e){const t=e.replace(/[^.\d]/gi,"");return Number.parseFloat(t)}function Pr(e,t){const r=Fe(e),o=Fe(t)*r/365/100;return{dataSource:[{interest:o,key:"1天",level:""},{interest:o*7,key:"1周（7天）",level:""},{interest:o*30,key:"1月（30天）",level:""},{interest:o*60,key:"2月（60天）",level:""},{interest:o*90,key:"3月（90天）",level:""},{interest:o*120,key:"4月（120天）",level:""},{interest:o*180,key:"半年（180天）",level:""},{interest:o*365,key:"1年（365天）",level:""},{interest:o*365*2,key:`2年（ ${365*2}天）`,level:""},{interest:o*365*3,key:`3年（${365*3}天）`,level:""},{interest:o*365*4,key:`4年（${365*4}天）`,level:""},{interest:o*365*5,key:`5年（${365*5}天）`,level:""}].map(a=>(a.interest=Number(a.interest.toFixed(2)),a.level=Nr(a.interest),a))}}const Ur=(e,t)=>{const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(let o=0;o<r.length;o++){const s=r[o],a=e[s],u=t[s];if(!(typeof a=="function"&&typeof u=="function")&&!Object.is(a,u))return!1}return!0},Ar=g.memo(({annualInterestRate:e,principal:t,onAnnualInterestRateChange:r,onPrincipalChange:n,...o})=>{const s=g.useMemo(()=>[{title:"时间",dataIndex:"key",width:120},{title:"利息",dataIndex:"interest",render(u,l){const c=l.level;return i.jsxs("div",{children:[i.jsx("div",{children:u.toLocaleString()}),i.jsx("div",{style:{fontSize:".86em"},children:c})]})}}],[]),a=g.useMemo(()=>Pr(e,t),[e,t]);return i.jsxs(y,{direction:"vertical",...o,children:[i.jsxs(z,{size:"small",labelAlign:"left",layout:"vertical",children:[i.jsx(z.Item,{label:"年化利率",style:{width:100},children:i.jsx(T,{value:e,onChange:u=>{const l=u.target.value;r(l)},suffix:"%"})}),i.jsx(z.Item,{label:"本金",children:i.jsx(T,{value:t,onChange:u=>{const l=u.target.value;n(l)},suffix:""})})]}),i.jsx(Rt,{size:"small",dataSource:a.dataSource,columns:s,pagination:!1,style:{width:260}})]})},Ur);delete localStorage.InterestCalculatorState;const xe=nt({dbName:"interestCalculator",dbVersion:1,objectStoreName:"inputs",keyPath:"uuid",onData(e){$r(t=>{Ee.reset(),t.uuid2input={};for(let r of e)t.uuid2input[r.uuid]=r,Ee.input(r.order)})}}),Ee=xr();function Br(){return{annualInterestRate:"1.6",principal:"10_0000",uuid:ce(),order:Ee.next()}}const $=Me({name:"interestCalculator",initialState:{uuid2input:Object.create(null)},reducers:{updateState(e,t){t.payload(e)},addGroup(e){const t=Br();e.uuid2input[t.uuid]=t;try{xe.getObjectStore({broadcast:!0}).add(t)}catch(r){reportError(r)}},removeGroup(e,t){const{uuid:r}=t.payload;delete e.uuid2input[r];try{xe.getObjectStore({broadcast:!0}).delete(r)}catch(n){reportError(n)}},updateGroup(e,t){const{uuid:r}=t.payload.input,n=e.uuid2input[r];n[t.payload.property]=t.payload.newVal;try{xe.getObjectStore({broadcast:!0}).put(G(n))}catch(o){reportError(o)}}}}),ct=Ge({reducer:$.reducer,middleware:e=>e({serializableCheck:{ignoredActions:["interestCalculator/updateState"]}})});function $r(e){ct.dispatch($.actions.updateState(t=>{e(t)}))}const ke=()=>i.jsx(We,{store:ct,children:i.jsx(zr,{})});ke.title="利息计算";ke.key="interest-calculator";const zr=()=>{const e=Je(),t=Ke(n=>n.uuid2input),r=Object.values(t).sort((n,o)=>n.order-o.order);return i.jsxs(w,{style:{marginInline:"16px"},gap:16,children:[r.map(n=>i.jsxs("div",{style:{position:"relative",backgroundColor:"#fff",padding:8},children:[i.jsx("div",{style:{position:"absolute",top:8,right:8},children:i.jsx(v,{size:"small",variant:"filled",color:"default",onClick:()=>{e($.actions.removeGroup(n))},children:"删除"})}),i.jsx(Ar,{annualInterestRate:n.annualInterestRate,principal:n.principal,onAnnualInterestRateChange:o=>{e($.actions.updateGroup({input:n,property:"annualInterestRate",newVal:o}))},onPrincipalChange:o=>{e($.actions.updateGroup({input:n,property:"principal",newVal:o}))}})]},n.uuid)),i.jsx("div",{style:{paddingTop:8},children:i.jsx(v,{size:"small",variant:"filled",color:"default",onClick:()=>{e($.actions.addGroup())},children:"添加一组"})})]})},qr=()=>{let[e,t]=g.useState(localStorage.tabKey);g.useEffect(()=>{e==="undefined"&&(e=void 0),e?(localStorage.tabKey=e,ir.activeTab(e)):delete localStorage.tabKey});const r=[Re,ke,Te,Oe].map(n=>({label:n.title,key:n.key,children:i.jsx(n,{})}));return r.find(n=>n.key===e)||t(r[0].key),i.jsxs(i.Fragment,{children:[i.jsx(Ot,{destroyInactiveTabPane:!0,defaultActiveKey:e,onChange:n=>t(n),activeKey:e,centered:!0,items:r}),i.jsx("div",{style:{height:32}})]})},Fr=kt.createRoot(document.getElementById("root"));Fr.render(i.jsx(It,{button:{autoInsertSpace:!1},children:i.jsx(qr,{})}));
